(this["webpackJsonpeco-rewards-admin"]=this["webpackJsonpeco-rewards-admin"]||[]).push([[0],{212:function(e,t,a){},213:function(e,t,a){},215:function(e,t,a){},355:function(e,t,a){},356:function(e,t,a){},357:function(e,t,a){},383:function(e,t,a){},384:function(e,t,a){},387:function(e,t,a){"use strict";a.r(t);var n,c,r=a(1),s=a(58),i=a.n(s),o=(a(212),a(213),a(27)),l=a(20),d=a(4),u=a.n(d),j=a(11),b=a(3),m=(a(215),a(0)),h=function(e){var t=e.auth,a=Object(l.g)(),n=(Object(l.h)().state||{from:{pathname:"/"}}).from,c=Object(r.useState)(""),s=Object(b.a)(c,2),i=s[0],o=s[1],d=Object(r.useState)(""),h=Object(b.a)(d,2),p=h[0],O=h[1],x=Object(r.useState)(""),f=Object(b.a)(x,2),v=f[0],g=f[1],w=Object(r.useState)(!0),y=Object(b.a)(w,2),N=y[0],k=y[1],S=function(){var e=Object(j.a)(u.a.mark((function e(a){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.next=3,t.login(p,v);case 3:t.isAuthenticated?window.location.href="/":o("Unable to login, please try again.");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return t.isAuthenticated&&a.replace(n),Object(m.jsx)("div",{className:"container",children:Object(m.jsx)("div",{className:"row justify-content-center",children:Object(m.jsx)("div",{className:"col-xl-10 col-lg-12 col-md-9",children:Object(m.jsx)("div",{className:"card o-hidden border-0 shadow-lg my-5",children:Object(m.jsx)("div",{className:"card-body p-0",children:Object(m.jsxs)("div",{className:"row",children:[Object(m.jsx)("div",{className:"col-lg-6 d-none d-lg-block bg-login-image"}),Object(m.jsx)("div",{className:"col-lg-6",children:Object(m.jsxs)("div",{className:"p-5",children:[Object(m.jsx)("div",{className:"text-center",children:Object(m.jsx)("h1",{className:"h4 text-gray-900 mb-4",children:"Login"})}),Object(m.jsxs)("form",{className:"user",children:[Object(m.jsx)("div",{className:"form-group",children:Object(m.jsx)("input",{type:"email",className:"form-control form-control-user",id:"exampleInputEmail","aria-describedby":"emailHelp",placeholder:"Enter Email Address...",onChange:function(e){return O(e.target.value)}})}),Object(m.jsx)("div",{className:"form-group",children:Object(m.jsx)("input",{type:"password",className:"form-control form-control-user",id:"exampleInputPassword",placeholder:"Password",onChange:function(e){return g(e.target.value)}})}),Object(m.jsx)("div",{className:"form-group",children:Object(m.jsxs)("div",{className:"custom-control custom-checkbox small",children:[Object(m.jsx)("input",{type:"checkbox",checked:N,onChange:function(){return k(!N)},className:"custom-control-input",id:"customCheck"}),Object(m.jsx)("label",{className:"custom-control-label",htmlFor:"customCheck",children:"Remember Me"})]})}),Object(m.jsx)("button",{className:"btn btn-primary btn-user btn-block",onClick:S,children:"Login"})]}),i&&Object(m.jsx)("hr",{}),i]})})]})})})})})})},p=a(22),O=a(201),x=a(392),f=a(393),v=a(394),g=a(189),w=a(190),y=a(79),N=a(76),k=["#4e73df","#1cc88a","#f6c23e","#36b9cc","#e74a3b","#858796"],S=function(e){var t=e.title,a=e.names,n=e.data,c=a.map((function(e,t){return Object(m.jsx)(O.a,{dataKey:e,fill:k[t%k.length]},t)}));return Object(m.jsxs)("div",{className:"card shadow mb-4",children:[Object(m.jsx)("div",{className:"card-header py-3",children:Object(m.jsx)("h6",{className:"m-0 font-weight-bold text-primary",children:t})}),Object(m.jsx)("div",{className:"card-body",children:n&&0!==n.length?Object(m.jsx)(x.a,{width:"99%",height:500,children:Object(m.jsxs)(f.a,{data:n,margin:{top:5,right:30,left:20,bottom:5},children:[Object(m.jsx)(v.a,{strokeDasharray:"3 3"}),Object(m.jsx)(g.a,{dataKey:"date"}),Object(m.jsx)(w.a,{}),Object(m.jsx)(y.a,{}),Object(m.jsx)(N.a,{}),c]})}):Object(m.jsx)("p",{children:"No data."})})]})},C=function(e){e.groups;var t=e.links,a=e.onChange,n=Object(r.useState)(""),c=Object(b.a)(n,2),s=c[0],i=c[1],o=Object.keys(t).filter((function(e){return e.startsWith("/scheme/")&&"/scheme/1"!==e})).map((function(e){return t[e]})),l=Object.keys(t).filter((function(e){return e.startsWith("/organisation/")&&t[e].scheme===s})).map((function(e){return t[e]}));return Object(m.jsxs)("div",{className:"group-select",children:[Object(m.jsxs)("select",{className:"col-3 custom-select form-control form-control-sm mr-3",name:"scheme",onChange:function(e){return t=i,n=e.target.value,t(n),void a(n);var t,n},children:[Object(m.jsx)("option",{value:"",children:"All schemes"}),o.map((function(e){return Object(m.jsx)("option",{value:e.id,children:e.name},e.id)}))]}),Object(m.jsxs)("select",{disabled:0===l.length,className:"col-3 custom-select form-control form-control-sm",name:"organisation",onChange:function(e){return a(e.target.value||s)},children:[Object(m.jsx)("option",{value:"",children:"All organisations"}),l.map((function(e){return Object(m.jsx)("option",{value:e.id,children:e.name},e.id)}))]})]})},D=a(191),M=function(e){for(var t=e.onChange,a=D.a.now(),n={"Last 7 days":[a.minusDays(7),a],"Last 14 days":[a.minusDays(14),a],"Last 30 days":[a.minusDays(30),a],"This month":[a.withDayOfMonth(1),a]},c=1;c<=6;c++){var r=a.minusMonths(c);n[r.month().name()]=[r.withDayOfMonth(1),r.plusMonths(1).withDayOfMonth(1).minusDays(1)]}return Object(m.jsx)("select",{className:"custom-select form-control form-control-sm",onChange:function(e){return t(e.target.value)},children:Object.entries(n).map((function(e){var t=Object(b.a)(e,2),a=t[0],n=Object(b.a)(t[1],2),c=n[0],r=n[1];return Object(m.jsx)("option",{value:c.toJSON()+","+r.toJSON(),children:a.charAt(0)+a.slice(1).toLowerCase()},a)}))})},T=function(e){var t=e.api,a=Object(r.useState)("/global/0/report"),n=Object(b.a)(a,2),c=n[0],s=n[1],i=Object(r.useState)(),o=Object(b.a)(i,2),l=o[0],d=o[1],h=Object(r.useState)([]),O=Object(b.a)(h,2),x=O[0],f=O[1],v=Object(r.useState)([]),g=Object(b.a)(v,2),w=g[0],y=g[1],N=Object(r.useState)([]),k=Object(b.a)(N,2),D=k[0],T=k[1],E=Object(r.useState)([]),R=Object(b.a)(E,2),A=R[0],I=R[1],L=Object(r.useState)({}),P=Object(b.a)(L,2),U=P[0],F=P[1],W=Object(r.useState)(""),_=Object(b.a)(W,2),G=_[0],V=_[1];Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(u.a.mark((function e(){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("/groups");case 2:a=e.sent,I(a.data.data),F(a.data.links);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}0===A.length&&function(){e.apply(this,arguments)}()}),[t,A]),Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(u.a.mark((function e(){var a,n,r,s,i,o,l,j,b;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=G?"?from="+G.split(",").join("&to="):"",e.next=3,t.get(c+a);case 3:n=e.sent,r={},s={},i={},o={},l=Object(p.a)(n.data.data);try{for(l.s();!(j=l.n()).done;)b=j.value,r[b.date]=r[b.date]||{date:b.date},r[b.date][b.name]=b.totalCarbonSaving,i[b.date]=i[b.date]||{date:b.date},i[b.date][b.name]=b.totalDistance,s[b.date]=s[b.date]||{date:b.date},s[b.date][b.name]=b.totalRewardsEarned,o[b.name]=!0}catch(u){l.e(u)}finally{l.f()}d(Object.keys(o)),f(Object.values(r)),T(Object.values(i)),y(Object.values(s));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}l||function(){e.apply(this,arguments)}()}),[t,l,c,G]);return Object(m.jsxs)("div",{className:"container-fluid",children:[Object(m.jsx)("h1",{className:"h3 mb-2 text-gray-800",children:"Dashboard"}),Object(m.jsxs)("div",{className:"row",children:[Object(m.jsx)("div",{className:"col-9",children:Object(m.jsx)(C,{groups:A,links:U,onChange:function(e){s(e?e+"/report":"/global/0/report"),d(void 0)}})}),Object(m.jsx)("div",{className:"col-3",children:Object(m.jsx)(M,{onChange:function(e){V(e),d(void 0)}})})]}),l?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(S,{title:"Rewards Earned",data:w,names:l},"rewards"),Object(m.jsx)(S,{title:"Carbon Saving",data:x,names:l},"carbon"),Object(m.jsx)(S,{title:"Distance",data:D,names:l},"distance")]}):Object(m.jsx)("p",{children:"Loading"})]})},E=(a(355),function(){return Object(m.jsxs)("ul",{className:"navbar-nav bg-gradient-primary sidebar sidebar-dark accordion",id:"accordionSidebar",children:[Object(m.jsxs)(o.b,{className:"sidebar-brand d-flex align-items-center justify-content-center",to:"/",children:[Object(m.jsx)("div",{className:"sidebar-brand-icon rotate-n-15",children:Object(m.jsx)("i",{className:"fas fa-leaf"})}),Object(m.jsx)("div",{className:"sidebar-brand-text mx-3",children:"Eco Rewards Hub Admin"})]}),Object(m.jsx)("hr",{className:"sidebar-divider my-0"}),Object(m.jsx)("li",{className:"nav-item",children:Object(m.jsxs)(o.b,{exact:!0,activeClassName:"active",className:"nav-link",to:"/",children:[Object(m.jsx)("i",{className:"fas fa-fw fa-tachometer-alt"}),Object(m.jsx)("span",{children:"Dashboard"})]})}),Object(m.jsx)("hr",{className:"sidebar-divider"}),Object(m.jsx)("div",{className:"sidebar-heading",children:"Manage"}),Object(m.jsx)("li",{className:"nav-item",children:Object(m.jsxs)(o.b,{activeClassName:"active",className:"nav-link",to:"/schemes",children:[Object(m.jsx)("i",{className:"fas fa-fw fa-city"}),Object(m.jsx)("span",{children:"Schemes"})]})}),Object(m.jsx)("li",{className:"nav-item",children:Object(m.jsxs)(o.b,{activeClassName:"active",className:"nav-link",to:"/organisations",children:[Object(m.jsx)("i",{className:"fas fa-fw fa-school"}),Object(m.jsx)("span",{children:"Organisations"})]})}),Object(m.jsx)("li",{className:"nav-item",children:Object(m.jsxs)(o.b,{activeClassName:"active",className:"nav-link",to:"/groups",children:[Object(m.jsx)("i",{className:"fas fa-fw fa-users"}),Object(m.jsx)("span",{children:"Groups"})]})}),Object(m.jsx)("li",{className:"nav-item",children:Object(m.jsxs)(o.b,{activeClassName:"active",className:"nav-link",to:"/members",children:[Object(m.jsx)("i",{className:"fas fa-fw fa-user"}),Object(m.jsx)("span",{children:"Members"})]})}),Object(m.jsx)("hr",{className:"sidebar-divider"}),Object(m.jsx)("div",{className:"sidebar-heading",children:"Reports"}),Object(m.jsx)("li",{className:"nav-item",children:Object(m.jsxs)(o.b,{activeClassName:"active",className:"nav-link",to:"/journeys",children:[Object(m.jsx)("i",{className:"fas fa-fw fa-bus"}),Object(m.jsx)("span",{children:"Journeys"})]})}),Object(m.jsx)("li",{className:"nav-item",children:Object(m.jsxs)(o.b,{activeClassName:"active",className:"nav-link",to:"/devices",children:[Object(m.jsx)("i",{className:"fas fa-fw fa-bus"}),Object(m.jsx)("span",{children:"Device Status"})]})})]})}),R=function(e){var t=e.auth;return Object(m.jsxs)("nav",{className:"navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow",children:[Object(m.jsxs)("span",{className:"text-gray-600 small",children:["Welcome back, ",t.getName()]}),Object(m.jsx)("ul",{className:"navbar-nav ml-auto",children:Object(m.jsx)("li",{className:"nav-item dropdown no-arrow",children:Object(m.jsxs)("a",{className:"dropdown-toggle",href:"/logout",onClick:function(e){e.preventDefault(),t.logout(),window.location.href="/"},id:"userDropdown",role:"button","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",children:[Object(m.jsx)("span",{className:"mr-2 d-none d-lg-inline text-gray-600 small",children:"Logout"}),Object(m.jsx)("i",{className:"fas fa-user fa-sm fa-fw mr-2 text-gray-400"})]})})})]})},A=function(){return Object(m.jsx)("footer",{className:"sticky-footer bg-white",children:Object(m.jsx)("div",{className:"container my-auto",children:Object(m.jsx)("div",{className:"copyright text-center my-auto",children:Object(m.jsx)("span",{children:"Copyright \xa9 Eco Rewards"})})})})},I=a(21),L=function(e){var t=e.api,a=e.addScheme,n=Object(r.useState)(""),c=Object(b.a)(n,2),s=c[0],i=c[1],o=Object(r.useState)("0"),l=Object(b.a)(o,2),d=l[0],h=l[1],p=Object(r.useState)(""),O=Object(b.a)(p,2),x=O[0],f=O[1],v=function(){var e=Object(j.a)(u.a.mark((function e(n){var c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.prev=1,e.next=4,t.post("/scheme",{name:s,vacClientId:+d});case 4:c=e.sent,i(""),h("0"),f("Scheme created."),a(c.data),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),f("Error while creating scheme.");case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsxs)("div",{className:"card shadow mb-4",children:[Object(m.jsx)("div",{className:"card-header py-3",children:Object(m.jsx)("h6",{className:"m-0 font-weight-bold text-primary",children:"Create"})}),Object(m.jsx)("div",{className:"card-body",children:Object(m.jsxs)("form",{className:"table-responsive",onSubmit:v,style:{maxWidth:"450px"},children:[Object(m.jsx)("p",{children:x}),Object(m.jsxs)("table",{className:"table table-bordered",id:"dataTable",children:[Object(m.jsx)("thead",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{children:"Name"}),Object(m.jsx)("th",{children:"VAC Client ID"})]})}),Object(m.jsx)("tbody",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:Object(m.jsx)("input",{type:"text",name:"name",value:s,onChange:function(e){return i(e.target.value)},className:"col-12"})}),Object(m.jsx)("td",{children:Object(m.jsx)("input",{type:"text",name:"vacClientId",value:d,onChange:function(e){return h(e.target.value)},className:"col-12"})})]})})]}),Object(m.jsx)("button",{style:{width:"100px"},type:"submit",className:"btn btn-primary btn-user btn-block",disabled:s.length<3,children:"Create"})]})})]})},P=a(192),U=a(94),F=a(95),W=a.n(F),_=a(71),G=(a(356),function(e){var t=e.rows,a=e.columns,n=e.removeRows,c=e.editRow,s=e.api,i=Object(r.useState)([]),o=Object(b.a)(i,2),l=o[0],d=o[1],h=Object(r.useState)(!1),p=Object(b.a)(h,2),O=p[0],x=p[1],f=Object(r.useCallback)((function(e){d(e.selectedRows)}),[]),v=Object(r.useMemo)((function(){var e=function(){var e=Object(j.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.confirm("Are you sure you want to delete:\r ".concat(l.map((function(e){return e.name})),"?"))){e.next=5;break}return x(!O),e.next=4,Promise.all(l.map((function(e){return s.delete(e.id)})));case 4:n(l);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t=Object(m.jsx)("button",{className:"btn btn-danger",onClick:e,children:"Delete"},"delete"),a=c&&1===l.length?Object(m.jsx)("button",{className:"btn btn-primary",onClick:function(){return c(l[0])},children:"Edit"},"edit"):null;return Object(m.jsxs)(m.Fragment,{children:[a," ",t]})}),[l,O,s,n,c]),g=Object(r.useState)(""),w=Object(b.a)(g,2),y=w[0],N=w[1],k=Object(r.useState)(!1),S=Object(b.a)(k,1)[0],C=t.filter((function(e){return e.name&&e.name.includes(y)||e.id===y||e.id.includes(y)})),D=Object(r.useMemo)((function(){return Object(m.jsx)(V,{onFilter:function(e){return N(e.target.value)},filterText:y})}),[y]);return Object(m.jsxs)("div",{className:"card shadow mb-4",children:[Object(m.jsx)("div",{className:"card-header py-3",children:Object(m.jsx)("h6",{className:"m-0 font-weight-bold text-primary",children:"Edit"})}),Object(m.jsx)("div",{className:"card-body",children:Object(m.jsx)("div",{className:"table-responsive",children:Object(m.jsx)(W.a,{columns:a,data:C,pagination:!0,paginationResetDefaultPage:S,paginationPerPage:50,paginationRowsPerPageOptions:[10,50,100,250],subHeader:!0,subHeaderComponent:D,selectableRows:!0,contextActions:n?v:void 0,onSelectedRowsChange:f,clearSelectedRows:O})})})]})}),V=function(e){var t=e.filterText,a=e.onFilter;e.onClear;return Object(m.jsx)(B,{id:"search",type:"text",placeholder:"Filter By Name",value:t,onChange:a})},B=_.default.input(n||(n=Object(U.a)(["\n  height: 32px;\n  width: 200px;\n  border-radius: 3px;\n  border-top-left-radius: 5px;\n  border-bottom-left-radius: 5px;\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n  border: 1px solid #e5e5e5;\n  padding: 0 32px 0 16px;\n\n  &:hover {\n    cursor: pointer;\n  }\n"]))),H=function(e){var t=e.api,a=e.schemes,n=e.removeSchemes,c=a.map((function(e){return Object(I.a)({numeric_id:Object(P.toSchemeId)(e.id),id:e.id},e)}));return Object(m.jsx)(G,{columns:[{name:"ID",selector:"numeric_id",sortable:!0,width:"100px"},{name:"Name",selector:"name",sortable:!0},{name:"VAC Client ID",selector:"vacClientId",sortable:!0}],rows:c,removeRows:n,api:t})},J=function(e){var t=e.api,a=Object(r.useState)(),n=Object(b.a)(a,2),c=n[0],s=n[1],i=Object(r.useState)({}),o=Object(b.a)(i,2),l=o[0],d=o[1];Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(u.a.mark((function e(){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("/schemes");case 2:a=e.sent,s(a.data.data),d(a.data.links);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}c||function(){e.apply(this,arguments)}()}),[t,c]);return Object(m.jsxs)("div",{className:"container-fluid",children:[Object(m.jsx)("h1",{className:"h3 mb-2 text-gray-800",children:"Schemes"}),Object(m.jsx)("p",{className:"mb-4",children:"Create and manage schemes."}),Object(m.jsx)(L,{api:t,addScheme:function(e){"undefined"!==typeof c&&(c.push(e.data),s(c),d(Object(I.a)(Object(I.a)({},e.links),l)))}}),Object(m.jsx)(H,{api:t,schemes:c||[],removeSchemes:function(e){"undefined"!==typeof c&&s(c.filter((function(t){return!e.some((function(e){return t.id===e.id}))})))}})]})},q=function(e){var t=e.api,a=e.addOrganisation,n=e.schemes,c=Object(r.useState)(""),s=Object(b.a)(c,2),i=s[0],o=s[1],l=Object(r.useState)(""),d=Object(b.a)(l,2),h=d[0],p=d[1],O=Object(r.useState)(""),x=Object(b.a)(O,2),f=x[0],v=x[1],g=function(){var e=Object(j.a)(u.a.mark((function e(n){var c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.prev=1,e.next=4,t.post("/organisation",{name:i,scheme:h});case 4:c=e.sent,o(""),v("Organisation created."),a(c.data),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),v("Error while creating organisation.");case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsxs)("div",{className:"card shadow mb-4",children:[Object(m.jsx)("div",{className:"card-header py-3",children:Object(m.jsx)("h6",{className:"m-0 font-weight-bold text-primary",children:"Create"})}),Object(m.jsx)("div",{className:"card-body",children:Object(m.jsxs)("form",{className:"table-responsive",onSubmit:g,style:{maxWidth:"400px"},children:[Object(m.jsx)("p",{children:f}),Object(m.jsxs)("table",{className:"table table-bordered",id:"dataTable",children:[Object(m.jsx)("thead",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{children:"Name"}),Object(m.jsx)("th",{children:"Scheme"})]})}),Object(m.jsx)("tbody",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:Object(m.jsx)("input",{type:"text",name:"name",value:i,onChange:function(e){return o(e.target.value)},className:"col-12"})}),Object(m.jsx)("td",{children:Object(m.jsxs)("select",{name:"scheme",onChange:function(e){return p(e.target.value)},children:[Object(m.jsx)("option",{value:"",children:"<Select scheme>"}),n.map((function(e){return Object(m.jsx)(z,{scheme:e},e.id)}))]})})]})})]}),Object(m.jsx)("button",{style:{width:"100px"},type:"submit",className:"btn btn-primary btn-user btn-block",disabled:i.length<3||""===h,children:"Create"})]})})]})},z=function(e){var t=e.scheme;return Object(m.jsx)("option",{value:t.id,children:t.name})},K=a(196),$=function(e){var t=e.api,a=e.organisations,n=e.links,c=e.removeOrganisations,r=a.map((function(e){return{id:e.id,numeric_id:Object(K.toOrganisationId)(e.id),name:e.name,scheme:n[e.scheme].name}}));return Object(m.jsx)(G,{columns:[{name:"ID",selector:"numeric_id",sortable:!0,width:"100px"},{name:"Name",selector:"name",sortable:!0},{name:"Scheme",selector:"scheme",sortable:!0}],rows:r,api:t,removeRows:c})},Q=function(e){var t=e.api,a=Object(r.useState)(),n=Object(b.a)(a,2),c=n[0],s=n[1];Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(u.a.mark((function e(){var a,n,c,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.get("/organisations").then((function(e){return e.data})),t.get("/schemes").then((function(e){return e.data}))]);case 2:a=e.sent,n=Object(b.a)(a,2),c=n[0],r=n[1],s({organisations:c,schemes:r});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}c||function(){e.apply(this,arguments)}()}),[t,c]);return Object(m.jsxs)("div",{className:"container-fluid",children:[Object(m.jsx)("h1",{className:"h3 mb-2 text-gray-800",children:"Organisations"}),Object(m.jsx)("p",{className:"mb-4",children:"Create and manage organisations."}),Object(m.jsx)(q,{api:t,addOrganisation:function(e){c&&(c.organisations.data.push(e.data),c.organisations.links=Object(I.a)(Object(I.a)({},e.links),c.organisations.links),s(Object(I.a)({},c)))},schemes:c?c.schemes.data:[]}),Object(m.jsx)($,{api:t,removeOrganisations:function(e){c&&(c.organisations.data=c.organisations.data.filter((function(t){return!e.some((function(e){return t.id===e.id}))})),s(Object(I.a)({},c)))},organisations:c?c.organisations.data:[],links:c?c.organisations.links:{}})]})},Y=function(e){var t=e.api,a=e.addGroup,n=e.organisations,c=Object(r.useState)(""),s=Object(b.a)(c,2),i=s[0],o=s[1],l=Object(r.useState)(""),d=Object(b.a)(l,2),h=d[0],p=d[1],O=Object(r.useState)(""),x=Object(b.a)(O,2),f=x[0],v=x[1],g=function(){var e=Object(j.a)(u.a.mark((function e(n){var c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.prev=1,e.next=4,t.post("/group",{name:i,organisation:h});case 4:c=e.sent,o(""),v("Group created."),a(c.data),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),v("Error while creating group.");case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsxs)("div",{className:"card shadow mb-4",children:[Object(m.jsx)("div",{className:"card-header py-3",children:Object(m.jsx)("h6",{className:"m-0 font-weight-bold text-primary",children:"Create"})}),Object(m.jsx)("div",{className:"card-body",children:Object(m.jsxs)("form",{className:"table-responsive",onSubmit:g,style:{maxWidth:"400px"},children:[Object(m.jsx)("p",{children:f}),Object(m.jsxs)("table",{className:"table table-bordered",id:"dataTable",children:[Object(m.jsx)("thead",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{children:"Name"}),Object(m.jsx)("th",{children:"Organisation"})]})}),Object(m.jsx)("tbody",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:Object(m.jsx)("input",{type:"text",name:"name",value:i,onChange:function(e){return o(e.target.value)},className:"col-12"})}),Object(m.jsx)("td",{children:Object(m.jsxs)("select",{name:"organisation",onChange:function(e){return p(e.target.value)},children:[Object(m.jsx)("option",{value:"",children:"<Select organisation>"}),n.map((function(e){return Object(m.jsx)(X,{organisation:e},e.id)}))]})})]})})]}),Object(m.jsx)("button",{style:{width:"100px"},type:"submit",className:"btn btn-primary btn-user btn-block",disabled:i.length<3||""===h,children:"Create"})]})})]})},X=function(e){var t=e.organisation;return Object(m.jsx)("option",{value:t.id,children:t.name})},Z=a(197),ee=(a(357),function(e){var t=e.uri,a=e.columns,n=e.createRow,c=e.editRow,s=e.api,i=e.filterField,o=Object(r.useState)([]),l=Object(b.a)(o,2),d=l[0],h=l[1],p=Object(r.useState)(!1),O=Object(b.a)(p,2),x=O[0],f=O[1],v=Object(r.useState)([]),g=Object(b.a)(v,2),w=g[0],y=g[1],N=Object(r.useState)(0),k=Object(b.a)(N,2),S=k[0],C=k[1],D=Object(r.useState)(50),M=Object(b.a)(D,2),T=M[0],E=M[1],R=Object(r.useCallback)((function(e){h(e.selectedRows)}),[]),A=Object(r.useMemo)((function(){var e=function(){var e=Object(j.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.confirm("Are you sure you want to delete:\r ".concat(d.map((function(e){return e.name})),"?"))){e.next=5;break}return f(!x),e.next=4,Promise.all(d.map((function(e){return s.delete(e.id)})));case 4:y(w.filter((function(e){return!d.some((function(t){return e.id===t.id}))})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t=Object(m.jsx)("button",{className:"btn btn-danger",onClick:e,children:"Delete"},"delete"),a=c&&1===d.length?Object(m.jsx)("button",{className:"btn btn-primary",onClick:function(){return c(d[0])},children:"Edit"},"edit"):null;return Object(m.jsxs)(m.Fragment,{children:[a," ",t]})}),[d,x,s,c,w]),I=Object(r.useCallback)(function(){var e=Object(j.a)(u.a.mark((function e(a,c,r){var o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.get("".concat(t,"?page=").concat(a,"&quantity=").concat(c,"&filterText=").concat(r,"&filterField=").concat(i));case 2:o=e.sent,y(o.data.data.map((function(e){return n(e,o.data.links)}))),C(o.data.pagination.count);case 5:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),[s,n,i,t]),L=Object(r.useState)(""),P=Object(b.a)(L,2),U=P[0],F=P[1],_=Object(r.useCallback)((function(e){F(e.target.value),I(1,T,e.target.value)}),[T,F,I]),G=Object(r.useMemo)((function(){return Object(m.jsx)(te,{onFilter:_,filterText:U})}),[U,_]),V=function(){var e=Object(j.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:I(t,T,U);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),B=function(){var e=Object(j.a)(u.a.mark((function e(t,a){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E(50),I(a,t,U);case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){I(1,T,U)}),[T,U,I]),Object(m.jsxs)("div",{className:"card shadow mb-4",children:[Object(m.jsx)("div",{className:"card-header py-3",children:Object(m.jsx)("h6",{className:"m-0 font-weight-bold text-primary",children:"Edit"})}),Object(m.jsx)("div",{className:"card-body",children:Object(m.jsx)("div",{className:"table-responsive",children:Object(m.jsx)(W.a,{columns:a,data:w,pagination:!0,paginationServer:!0,paginationPerPage:50,paginationRowsPerPageOptions:[10,50,100,250],paginationTotalRows:S,subHeader:!0,subHeaderComponent:G,selectableRows:!0,contextActions:A,onSelectedRowsChange:R,onChangeRowsPerPage:B,onChangePage:V,clearSelectedRows:x})})})]})}),te=function(e){var t=e.filterText,a=e.onFilter;e.onClear;return Object(m.jsx)(ae,{id:"search",type:"text",placeholder:"Filter By Name",value:t,onChange:a})},ae=_.default.input(c||(c=Object(U.a)(["\n  height: 32px;\n  width: 200px;\n  border-radius: 3px;\n  border-top-left-radius: 5px;\n  border-bottom-left-radius: 5px;\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n  border: 1px solid #e5e5e5;\n  padding: 0 32px 0 16px;\n\n  &:hover {\n    cursor: pointer;\n  }\n"]))),ne=function(e){var t=e.api;return Object(m.jsx)(ee,{columns:[{name:"ID",selector:"numeric_id",sortable:!0,width:"100px"},{name:"Name",selector:"name",sortable:!0},{name:"Organisation",selector:"organisation",sortable:!0}],uri:"/groups",api:t,createRow:function(e,t){return{id:e.id,numeric_id:Object(Z.toGroupId)(e.id),name:e.name,organisation:t[e.organisation].name}},filterField:"name"})},ce=function(e){var t=e.api,a=Object(r.useState)(),n=Object(b.a)(a,2),c=n[0],s=n[1];Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(u.a.mark((function e(){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("/organisations").then((function(e){return e.data.data}));case 2:a=e.sent,s(a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}c||function(){e.apply(this,arguments)}()}),[t,c]);return Object(m.jsxs)("div",{className:"container-fluid",children:[Object(m.jsx)("h1",{className:"h3 mb-2 text-gray-800",children:"Groups"}),Object(m.jsx)("p",{className:"mb-4",children:"Create and manage groups."}),Object(m.jsx)(Y,{api:t,addGroup:function(){window.location.reload()},organisations:c||[]}),Object(m.jsx)(ne,{api:t})]})},re=function(e){var t=e.defaultTransportMode,a=e.setDefaultTransportMode;return Object(m.jsxs)("select",{className:"custom-select custom-select-sm form-control form-control-sm",name:"defaultTransportMode",defaultValue:t,onChange:function(e){return a(e.target.value)},children:[Object(m.jsx)("option",{value:"",children:"Select green transport mode"}),["Car share","Large car","Medium car","Small car","Electric car","Taxi","Park and ride","Tram","Bus","Train","Cycling","Walk","Work from home"].map((function(e,t){return Object(m.jsx)("option",{value:e.toLowerCase(),children:e},t)}))]})},se=function(e){var t=e.api,a=e.addMembers,n=e.groups,c=Object(r.useState)(""),s=Object(b.a)(c,2),i=s[0],o=s[1],l=Object(r.useState)(""),d=Object(b.a)(l,2),h=d[0],p=d[1],O=Object(r.useState)("0.00"),x=Object(b.a)(O,2),f=x[0],v=x[1],g=Object(r.useState)("10"),w=Object(b.a)(g,2),y=w[0],N=w[1],k=Object(r.useState)(""),S=Object(b.a)(k,2),C=S[0],D=S[1],M=function(){var e=Object(j.a)(u.a.mark((function e(n){var c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.prev=1,e.next=4,t.post("/members",{group:i,defaultTransportMode:h,defaultDistance:+f,quantity:+y});case 4:c=e.sent,v("0.00"),D(y+" new members created."),N("10"),a(c.data),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),D("Error while creating members.");case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}(),T=i.length>2&&+y>0;return Object(m.jsxs)("div",{className:"card shadow mb-4",children:[Object(m.jsx)("div",{className:"card-header py-3",children:Object(m.jsx)("h6",{className:"m-0 font-weight-bold text-primary",children:"Create"})}),Object(m.jsx)("div",{className:"card-body",children:Object(m.jsxs)("form",{className:"table-responsive",onSubmit:M,style:{maxWidth:"650px"},children:[Object(m.jsx)("p",{children:C}),Object(m.jsxs)("table",{className:"table table-bordered",id:"dataTable",children:[Object(m.jsx)("thead",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{children:"Group"}),Object(m.jsx)("th",{children:"Default Mode"}),Object(m.jsx)("th",{children:"Default Distance"}),Object(m.jsx)("th",{children:"Quantity"})]})}),Object(m.jsx)("tbody",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:Object(m.jsxs)("select",{className:"custom-select custom-select-sm form-control form-control-sm",name:"group",onChange:function(e){return o(e.target.value)},children:[Object(m.jsx)("option",{value:"",children:"<Select group>"}),n.map((function(e){return Object(m.jsx)("option",{value:e.id,children:e.name},e.id)}))]})}),Object(m.jsx)("td",{children:Object(m.jsx)(re,{defaultTransportMode:h,setDefaultTransportMode:p})}),Object(m.jsx)("td",{children:Object(m.jsx)("input",{type:"text",name:"defaultDistance",value:f,onChange:function(e){return v(e.target.value)},className:"col-12"})}),Object(m.jsx)("td",{children:Object(m.jsx)("input",{type:"text",name:"quantity",value:y,onChange:function(e){return N(e.target.value)},className:"col-12"})})]})})]}),Object(m.jsx)("button",{style:{width:"100px"},type:"submit",className:"btn btn-primary btn-user btn-block",disabled:!T,children:"Create"})]})})]})},ie=a(126),oe=a.n(ie);oe.a.setAppElement("#root");var le={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",border:"none",background:"none"},overlay:{zIndex:2,backgroundColor:"rgba(150,150,150, 0.65)"}},de=function(e){var t=e.api,a=e.members,n=e.links,c=e.removeMembers,s=e.groups,i=a.map((function(e){return{id:e.id,numeric_id:e.id.substr(8),name:n[e.group].name,group:e.group,defaultTransportMode:e.defaultTransportMode,defaultDistance:e.defaultDistance+" miles",previousTransportMode:e.previousTransportMode,totalMiles:e.totalMiles+" miles",carbonSaving:e.carbonSaving+"kg",rewards:e.rewards,organisation:n[n[e.group].organisation].name,scheme:n[n[n[e.group].organisation].scheme].name}})),o=Object(r.useState)(),l=Object(b.a)(o,2),d=l[0],h=l[1],p=Object(r.useState)(),O=Object(b.a)(p,2),x=O[0],f=O[1],v=Object(r.useState)(""),g=Object(b.a)(v,2),w=g[0],y=g[1],N=Object(r.useState)(""),k=Object(b.a)(N,2),S=k[0],C=k[1],D=Object(r.useState)("0"),M=Object(b.a)(D,2),T=M[0],E=M[1],R=Object(r.useState)("0"),A=Object(b.a)(R,2),I=A[0],L=A[1],P=Object(r.useState)("0"),U=Object(b.a)(P,2),F=U[0],W=U[1],_=Object(r.useState)("0"),V=Object(b.a)(_,2),B=V[0],H=V[1],J=Object(r.useState)(),q=Object(b.a)(J,2),z=q[0],K=q[1],$=function(){window.location.reload()},Q=function(){var e=Object(j.a)(u.a.mark((function e(n){var c,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),d&&"undefined"!==typeof T){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,c={group:z,defaultTransportMode:w,previousTransportMode:S,defaultDistance:+T,totalMiles:+B,rewards:+F,carbonSaving:+I},e.next=7,t.put(d.id,c);case 7:r=a.find((function(e){return e.id===d.id})),Object.assign(r,c),h(void 0),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),f("Error while updating.");case 15:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(G,{columns:[{name:"ID",selector:"numeric_id",sortable:!0,width:"175px"},{name:"Scheme",selector:"scheme",sortable:!0},{name:"Organisation",selector:"organisation",sortable:!0},{name:"Group",selector:"name",sortable:!0},{name:"Default Mode",selector:"defaultTransportMode",sortable:!1,width:"140px"},{name:"Previous Mode",selector:"previousTransportMode",sortable:!1,width:"140px"},{name:"Default Distance",selector:"defaultDistance",sortable:!0,width:"130px"},{name:"Rewards",selector:"rewards",sortable:!0,width:"90px"},{name:"Carbon Saving",selector:"carbonSaving",sortable:!0,width:"130px"},{name:"Total Miles",selector:"totalMiles",sortable:!0,width:"130px"}],rows:i,api:t,removeRows:c,editRow:function(e){h(e),E(e.defaultDistance.replace(" miles","")),y(e.defaultTransportMode),C(e.previousTransportMode),L(e.carbonSaving.replace("kg","")),W(e.rewards+""),H(e.totalMiles.replace(" miles","")),K(e.group)}}),Object(m.jsx)(oe.a,{style:le,isOpen:!!d,onRequestClose:$,contentLabel:"Edit Member",children:Object(m.jsxs)("div",{className:"card shadow mb-4",children:[Object(m.jsx)("div",{className:"card-header py-3",children:Object(m.jsx)("h6",{className:"m-0 font-weight-bold text-primary",children:"Edit Member"})}),Object(m.jsx)("div",{className:"card-body",children:Object(m.jsxs)("form",{className:"table-responsive",onSubmit:Q,style:{maxWidth:"650px"},children:[Object(m.jsx)("p",{children:x}),Object(m.jsx)("table",{className:"table table-bordered",id:"dataTable",children:Object(m.jsxs)("tbody",{children:[Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:"Group"}),Object(m.jsx)("td",{children:Object(m.jsx)("select",{className:"custom-select custom-select-sm form-control form-control-sm",name:"group",onChange:function(e){return K(e.target.value)},defaultValue:z,children:s.map((function(e){return Object(m.jsx)("option",{value:e.id,children:e.name},e.id)}))})})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:"Default Transport Mode"}),Object(m.jsx)("td",{children:Object(m.jsx)(re,{defaultTransportMode:w,setDefaultTransportMode:y})})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:"Previous Transport Mode"}),Object(m.jsx)("td",{children:Object(m.jsx)(re,{defaultTransportMode:S,setDefaultTransportMode:C})})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:"Default Distance"}),Object(m.jsx)("td",{children:Object(m.jsx)("input",{type:"text",name:"defaultDistance",value:T,onChange:function(e){return E(e.target.value)},className:"col-12"})})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:"Rewards"}),Object(m.jsx)("td",{children:Object(m.jsx)("input",{type:"text",name:"rewards",value:F,onChange:function(e){return W(e.target.value)},className:"col-12"})})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:"Carbon Saving"}),Object(m.jsx)("td",{children:Object(m.jsx)("input",{type:"text",name:"carbonSaving",value:I,onChange:function(e){return L(e.target.value)},className:"col-12"})})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:"Total Miles"}),Object(m.jsx)("td",{children:Object(m.jsx)("input",{type:"text",name:"totalMiles",value:B,onChange:function(e){return H(e.target.value)},className:"col-12"})})]})]})}),Object(m.jsxs)("div",{className:"container row pl-3 pr-0",children:[Object(m.jsx)("div",{className:"col-6 p-0",children:Object(m.jsx)("input",{type:"button",value:"Cancel",style:{width:"100px"},className:"btn btn-light btn-user btn-block",onClick:$})}),Object(m.jsx)("div",{className:"col-6 p-0",children:Object(m.jsx)("button",{style:{width:"100px",float:"right"},type:"submit",className:"btn btn-primary btn-user btn-block",children:"Update"})})]})]})})]})})]})},ue=function(e){var t=e.api,a=e.groups,n=Object(r.useState)(""),c=Object(b.a)(n,2),s=c[0],i=c[1],o=Object(r.useState)(""),l=Object(b.a)(o,2),d=l[0],h=l[1],p=Object(r.useState)(""),O=Object(b.a)(p,2),x=O[0],f=O[1],v=Object(r.useState)(""),g=Object(b.a)(v,2),w=g[0],y=g[1],N=Object(r.useState)(""),k=Object(b.a)(N,2),S=k[0],C=k[1],D=function(){var e=Object(j.a)(u.a.mark((function e(a){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.prev=1,n={startId:s,endId:d,group:""===x?void 0:x,defaultTransportMode:""===w?void 0:w,defaultDistance:""===S?void 0:+S},e.next=5,t.patch("/members",n);case 5:window.location.reload(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),alert("Error while creating members.");case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),M=s.length>8&&d.length>8&&s<d&&(!!x||w||S);return Object(m.jsxs)("div",{className:"card shadow mb-4",children:[Object(m.jsx)("div",{className:"card-header py-3",children:Object(m.jsx)("h6",{className:"m-0 font-weight-bold text-primary",children:"Create"})}),Object(m.jsx)("div",{className:"card-body",children:Object(m.jsxs)("form",{className:"table-responsive",onSubmit:D,style:{maxWidth:"1000px"},children:[Object(m.jsxs)("table",{className:"table table-bordered",id:"dataTable",children:[Object(m.jsx)("thead",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{children:"Start ID"}),Object(m.jsx)("th",{children:"End ID"}),Object(m.jsx)("th",{children:"Group"}),Object(m.jsx)("th",{children:"Default Mode"}),Object(m.jsx)("th",{children:"Default Distance"})]})}),Object(m.jsx)("tbody",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:Object(m.jsx)("input",{type:"text",name:"startId",value:s,onChange:function(e){return i(e.target.value)}})}),Object(m.jsx)("td",{children:Object(m.jsx)("input",{type:"text",name:"endId",value:d,onChange:function(e){return h(e.target.value)}})}),Object(m.jsx)("td",{children:Object(m.jsxs)("select",{className:"custom-select custom-select-sm form-control form-control-sm",name:"group",onChange:function(e){return f(e.target.value)},children:[Object(m.jsx)("option",{value:"",children:"<Select group>"}),a.map((function(e){return Object(m.jsx)("option",{value:e.id,children:e.name},e.id)}))]})}),Object(m.jsx)("td",{children:Object(m.jsx)(re,{defaultTransportMode:w,setDefaultTransportMode:y})}),Object(m.jsx)("td",{children:Object(m.jsx)("input",{type:"text",name:"defaultDistance",value:S,onChange:function(e){return C(e.target.value)},className:"col-12"})})]})})]}),Object(m.jsx)("button",{style:{width:"100px"},type:"submit",className:"btn btn-primary btn-user btn-block",disabled:!M,children:"Update"})]})})]})},je=function(e){var t=e.api,a=Object(r.useState)(),n=Object(b.a)(a,2),c=n[0],s=n[1];Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(u.a.mark((function e(){var a,n,c,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([t.get("/members").then((function(e){return e.data})),t.get("/groups").then((function(e){return e.data}))]);case 2:a=e.sent,n=Object(b.a)(a,2),c=n[0],r=n[1],s({members:c,groups:r});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}c||function(){e.apply(this,arguments)}()}),[t,c]);var i=function(){var e=Object(j.a)(u.a.mark((function e(){var a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("/members",{headers:{Accept:"text/csv"}});case 2:a=e.sent,(n=document.createElement("a")).style.display="none",document.body.appendChild(n),n.href=window.URL.createObjectURL(new Blob([a.data],{type:"text/csv"})),n.setAttribute("download","members.csv"),n.click(),window.URL.revokeObjectURL(n.href),document.body.removeChild(n);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(m.jsxs)("div",{className:"container-fluid",children:[Object(m.jsx)("h1",{className:"h3 mb-2 text-gray-800",children:"Members"}),Object(m.jsx)("p",{className:"mb-4",children:"Create and manage members."}),Object(m.jsxs)("div",{className:"card shadow mb-4",children:[Object(m.jsx)("div",{className:"card-header py-3",children:Object(m.jsx)("h6",{className:"m-0 font-weight-bold text-primary",children:"Export"})}),Object(m.jsxs)("div",{className:"card-body",children:[Object(m.jsx)("p",{children:"Export all members as CSV"}),Object(m.jsxs)("p",{children:[Object(m.jsx)("button",{className:"btn btn-primary",onClick:i,children:"Export"})," "]})]})]}),Object(m.jsx)(se,{api:t,addMembers:function(e){c&&(c.members.data=c.members.data.concat(e.data),c.members.links=Object(I.a)(Object(I.a)({},e.links),c.members.links),s(Object(I.a)({},c)))},groups:c?c.groups.data:[]}),Object(m.jsx)(de,{api:t,removeMembers:function(e){c&&(c.members.data=c.members.data.filter((function(t){return!e.some((function(e){return t.id===e.id}))})),s(Object(I.a)({},c)))},groups:c?c.groups.data:[],members:c?c.members.data:[],links:c?c.members.links:{}}),Object(m.jsx)(ue,{api:t,groups:c?c.groups.data:[]})]})},be=function(e){var t=e.api,a=e.onJourneysUploaded,n=Object(r.useRef)(null),c=Object(r.useState)(""),s=Object(b.a)(c,2),i=s[0],o=s[1],l=function(){var e=Object(j.a)(u.a.mark((function e(c){var r,s,i,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.preventDefault(),n.current.files[0]){e.next=3;break}return e.abrupt("return",o("Please select a CSV file"));case 3:return e.prev=3,(r=new FormData).append("file",n.current.files[0],"upload.csv"),s={"Content-Type":"multipart/form-data"},e.next=9,t.post("/journeys",r,{headers:s}).then((function(e){return e.data.data.errors}));case 9:i=e.sent,l=0===i.length?"Upload successful":i.join("\n"),o(l),a(),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),o("Error while uploading journeys.");case 18:case"end":return e.stop()}}),e,null,[[3,15]])})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsxs)("div",{className:"card shadow mb-4",children:[Object(m.jsx)("div",{className:"card-header py-3",children:Object(m.jsx)("h6",{className:"m-0 font-weight-bold text-primary",children:"Upload"})}),Object(m.jsx)("div",{className:"card-body",children:Object(m.jsxs)("form",{className:"table-responsive",onSubmit:l,style:{maxWidth:"650px"},children:[Object(m.jsx)("p",{children:i}),Object(m.jsx)("input",{type:"file",name:"uploadFile",ref:n}),Object(m.jsx)("button",{style:{width:"100px",marginTop:"20px"},type:"submit",className:"btn btn-primary btn-user btn-block",children:"Upload"})]})})]})},me=function(e){var t=e.api,a=e.journeys.map((function(e,t){return Object(I.a)(Object(I.a)({},e),{},{name:e.memberId.substr(8),id:e.memberId.substr(8)+"_"+t,numeric_id:e.memberId.substr(8),uploaded:new Date(e.uploaded+"+0000").toLocaleString(),travelDate:new Date(e.travelDate+"+0000").toLocaleString(),processed:null===e.processed?"Pending":new Date(e.processed+"+0000").toLocaleString(),carbonSaving:null===e.carbonSaving?"-":e.carbonSaving+"kg",distance:null===e.distance?"-":e.distance+" miles",rewardsEarned:null===e.rewardsEarned?"-":e.rewardsEarned})}));return Object(m.jsx)(G,{columns:[{name:"Member ID",selector:"numeric_id",sortable:!0,width:"180px"},{name:"Source",selector:"source",sortable:!0,width:"110px"},{name:"Device",selector:"deviceId",sortable:!0,width:"110px"},{name:"Latitude",selector:"latitude",sortable:!1,width:"100px"},{name:"Longitude",selector:"longitude",sortable:!1,width:"100px"},{name:"Uploaded",selector:"uploaded",sortable:!0,width:"170px"},{name:"Processed",selector:"processed",sortable:!0,width:"170px"},{name:"Travel Date",selector:"travelDate",sortable:!0,width:"170px"},{name:"Distance",selector:"distance",sortable:!0,width:"90px"},{name:"Mode",selector:"mode",sortable:!0,width:"90px"},{name:"Rewards Earned",selector:"rewardsEarned",sortable:!0,width:"80px"},{name:"Carbon Saving",selector:"carbonSaving",sortable:!0,width:"80px"}],rows:a,api:t})},he=function(e){var t=e.api,a=Object(r.useState)(),n=Object(b.a)(a,2),c=n[0],s=n[1];Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(u.a.mark((function e(){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("/journeys").then((function(e){return e.data}));case 2:a=e.sent,s({journeys:a});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}c||function(){e.apply(this,arguments)}()}),[t,c]);var i=function(){var e=Object(j.a)(u.a.mark((function e(){var a,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("/journeys",{headers:{Accept:"text/csv"}});case 2:a=e.sent,(n=document.createElement("a")).style.display="none",document.body.appendChild(n),n.href=window.URL.createObjectURL(new Blob([a.data],{type:"text/csv"})),n.setAttribute("download","members.csv"),n.click(),window.URL.revokeObjectURL(n.href),document.body.removeChild(n);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(m.jsxs)("div",{className:"container-fluid",children:[Object(m.jsx)("h1",{className:"h3 mb-2 text-gray-800",children:"Journeys"}),Object(m.jsx)("p",{className:"mb-4",children:"View, upload and export member journeys."}),Object(m.jsxs)("div",{className:"card shadow mb-4",children:[Object(m.jsx)("div",{className:"card-header py-3",children:Object(m.jsx)("h6",{className:"m-0 font-weight-bold text-primary",children:"Export"})}),Object(m.jsxs)("div",{className:"card-body",children:[Object(m.jsx)("p",{children:"Export all member journeys as CSV"}),Object(m.jsxs)("p",{children:[Object(m.jsx)("button",{className:"btn btn-primary",onClick:i,children:"Export"})," "]})]})]}),Object(m.jsx)(be,{api:t,onJourneysUploaded:function(){s(void 0)}}),Object(m.jsx)(me,{api:t,journeys:c?c.journeys.data:[]})]})},pe=function(e){var t=e.api,a=e.statuses.map((function(e,t){return{id:t+"",name:e.deviceId,numeric_id:e.deviceId,received:new Date(e.received+"+0000").toLocaleString(),status:e.status}}));return Object(m.jsx)(G,{columns:[{name:"Device ID",selector:"numeric_id",sortable:!0,width:"110px"},{name:"Received",selector:"received",sortable:!0,width:"180px"},{name:"Status",selector:"status",sortable:!1}],rows:a,api:t})},Oe=function(e){var t=e.api,a=Object(r.useState)(),n=Object(b.a)(a,2),c=n[0],s=n[1];return Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(u.a.mark((function e(){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("/devices").then((function(e){return e.data}));case 2:a=e.sent,s({statuses:a});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}c||function(){e.apply(this,arguments)}()}),[t,c]),Object(m.jsxs)("div",{className:"container-fluid",children:[Object(m.jsx)("h1",{className:"h3 mb-2 text-gray-800",children:"Device Status"}),Object(m.jsx)("p",{className:"mb-4",children:"View status messages from devices connected to The Things Network."}),Object(m.jsx)(pe,{api:t,statuses:c?c.statuses.data:[]})]})},xe=function(e){var t=e.auth;return Object(m.jsxs)("div",{id:"wrapper",children:[Object(m.jsx)(E,{}),Object(m.jsxs)("div",{id:"content-wrapper",className:"d-flex flex-column",children:[Object(m.jsxs)("div",{id:"content",children:[Object(m.jsx)(R,{auth:t}),Object(m.jsx)(o.a,{children:Object(m.jsxs)(l.d,{children:[Object(m.jsx)(l.b,{path:"/schemes",children:Object(m.jsx)(J,{api:t.getAuthenticatedApi()})}),Object(m.jsx)(l.b,{path:"/organisations",children:Object(m.jsx)(Q,{api:t.getAuthenticatedApi()})}),Object(m.jsx)(l.b,{path:"/groups",children:Object(m.jsx)(ce,{api:t.getAuthenticatedApi()})}),Object(m.jsx)(l.b,{path:"/members",children:Object(m.jsx)(je,{api:t.getAuthenticatedApi()})}),Object(m.jsx)(l.b,{path:"/journeys",children:Object(m.jsx)(he,{api:t.getAuthenticatedApi()})}),Object(m.jsx)(l.b,{path:"/devices",children:Object(m.jsx)(Oe,{api:t.getAuthenticatedApi()})}),Object(m.jsx)(l.b,{path:"/",children:Object(m.jsx)(T,{api:t.getAuthenticatedApi()})})]})})]}),Object(m.jsx)(A,{})]})]})},fe=a(203),ve=function(e){var t=e.children,a=e.auth,n=Object(fe.a)(e,["children","auth"]);return Object(m.jsx)(l.b,Object(I.a)(Object(I.a)({},n),{},{render:function(e){var n=e.location;return a.isAuthenticated?t:Object(m.jsx)(l.a,{to:{pathname:"/login",state:{from:n}}})}}))},ge=a(198),we=a(199),ye=a(96),Ne=a.n(ye),ke=function(){function e(t,a){var n;Object(ge.a)(this,e),this.api=t,this.cookies=a,this.authenticatedApi=void 0,this.authenticatedApi=Ne.a.create({baseURL:t.defaults.baseURL,headers:{authorization:"Basic "+(null===(n=this.cookies.get("auth"))||void 0===n?void 0:n.token)}})}return Object(we.a)(e,[{key:"isAuthenticated",get:function(){return this.cookies.get("auth")&&void 0!==this.cookies.get("auth").token}},{key:"login",value:function(){var e=Object(j.a)(u.a.mark((function e(t,a){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.api.post("/login",{username:t,password:a});case 3:n=e.sent,this.cookies.set("auth",n.data.data,{sameSite:"strict"}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"logout",value:function(){this.cookies.remove("auth")}},{key:"getAuthenticatedApi",value:function(){return this.authenticatedApi}},{key:"getName",value:function(){return this.cookies.get("name")}}]),e}(),Se=(a(383),a(384),function(e){var t=e.groups,a=e.links,n=(e.group,e.setGroup),c=Object(r.useState)(""),s=Object(b.a)(c,2),i=s[0],o=s[1],l=Object(r.useState)(""),d=Object(b.a)(l,2),u=d[0],j=d[1],h=Object.keys(a).filter((function(e){return e.startsWith("/scheme/")&&"/scheme/1"!==e})).map((function(e){return a[e]})),p=Object.keys(a).filter((function(e){return e.startsWith("/organisation/")&&a[e].scheme===i})).map((function(e){return a[e]})),O=t.filter((function(e){return e.organisation===u}));return Object(m.jsxs)("div",{className:"group-select",children:[Object(m.jsxs)("select",{className:"custom-select form-control form-control-sm",name:"scheme",onChange:function(e){return o(e.target.value)},children:[Object(m.jsx)("option",{value:"",children:"<Select scheme>"}),h.map((function(e){return Object(m.jsx)("option",{value:e.id,children:e.name},e.id)}))]}),Object(m.jsxs)("select",{disabled:0===p.length,className:"custom-select form-control form-control-sm",name:"organisation",onChange:function(e){return j(e.target.value)},children:[Object(m.jsx)("option",{value:"",children:"<Select organisation>"}),p.map((function(e){return Object(m.jsx)("option",{value:e.id,children:e.name},e.id)}))]}),Object(m.jsxs)("select",{disabled:0===O.length,className:"custom-select form-control form-control-sm",name:"group",onChange:function(e){return n(e.target.value)},children:[Object(m.jsx)("option",{value:"",children:"<Select group>"}),O.map((function(e){return Object(m.jsx)("option",{value:e.id,children:e.name},e.id)}))]})]})}),Ce=function(e){var t=e.api,a=Object(r.useState)(!1),n=Object(b.a)(a,2),c=n[0],s=n[1],i=Object(r.useState)(""),o=Object(b.a)(i,2),l=o[0],d=o[1],h=Object(r.useState)(""),p=Object(b.a)(h,2),O=p[0],x=p[1],f=Object(r.useState)(""),v=Object(b.a)(f,2),g=v[0],w=v[1],y=Object(r.useState)(1),N=Object(b.a)(y,2),k=N[0],S=N[1],C=Object(r.useState)(""),D=Object(b.a)(C,2),M=D[0],T=D[1],E=Object(r.useState)([]),R=Object(b.a)(E,2),A=R[0],I=R[1],L=Object(r.useState)({}),P=Object(b.a)(L,2),U=P[0],F=P[1];Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(u.a.mark((function e(){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("/groups");case 2:a=e.sent,I(a.data.data),F(a.data.links);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}0===A.length&&function(){e.apply(this,arguments)}()}),[t,A]);var W=function(){var e=Object(j.a)(u.a.mark((function e(a){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.prev=1,e.next=4,t.post("/member",{smartcard:O,defaultTransportMode:g,defaultDistance:k,group:M});case 4:s(!0),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),d("Unable to register, please try again.");case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}(),_=(16===O.length||18===O.length)&&""!==g&&k>0&&""!==M;return Object(m.jsx)("div",{className:"container",children:Object(m.jsx)("div",{className:"row justify-content-center",children:Object(m.jsx)("div",{className:"col-xl-10 col-lg-12 col-md-9",children:Object(m.jsx)("div",{className:"card o-hidden border-0 shadow-lg my-5",children:Object(m.jsx)("div",{className:"card-body p-0",children:Object(m.jsxs)("div",{className:"row",children:[Object(m.jsx)("div",{className:"col-lg-6 d-none d-lg-block bg-login-image"}),Object(m.jsx)("div",{className:"col-lg-6",children:Object(m.jsx)("div",{className:"p-5",children:c?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("div",{className:"text-center",children:Object(m.jsx)("h1",{className:"h4 text-gray-900 mb-4",children:"SUCCESS - Your card has been registered!"})}),Object(m.jsx)("p",{children:"Thank you."}),Object(m.jsxs)("p",{children:["Using your smartcard to report green travel choices will now add points and carbon savings to your account. For more information and to access Eco Rewards, go to ",Object(m.jsx)("a",{href:"https://www.ecorewards.org.uk",children:"ecorewards.org.uk"})," create your personal account."]}),Object(m.jsx)("br",{})]}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("div",{className:"text-center",children:Object(m.jsx)("h1",{className:"h4 text-gray-900 mb-4",children:"Register"})}),Object(m.jsxs)("form",{className:"user",children:[Object(m.jsx)("div",{className:"form-group",children:Object(m.jsx)("input",{type:"text",className:"form-control form-control-user",id:"exampleInputSmartcard",pattern:"^[0-9]*$",minLength:16,maxLength:18,"aria-describedby":"smartcardHelp",placeholder:"Enter Smartcard number",required:!0,onChange:function(e){return x(e.target.value)}})}),Object(m.jsx)("div",{className:"form-group",children:Object(m.jsx)(re,{defaultTransportMode:g,setDefaultTransportMode:w})}),Object(m.jsx)("div",{className:"form-group",children:Object(m.jsx)("input",{type:"text",className:"form-control form-control-user",id:"exampleInputDistance","aria-describedby":"distanceHelp",placeholder:"Enter normal distance in miles",required:!0,onChange:function(e){return S(+e.target.value)}})}),Object(m.jsx)("div",{className:"form-group",children:Object(m.jsx)(Se,{group:M,setGroup:T,groups:A,links:U})}),Object(m.jsx)("button",{type:"submit",className:"btn btn-primary btn-user btn-block",onClick:W,disabled:!_,children:"Register"})]}),l&&Object(m.jsx)("hr",{}),l]})})})]})})})})})})},De=a(202),Me=function(){var e=Ne.a.create({baseURL:"https://api.ecorewards.co.uk"}),t=new De.a,a=new ke(e,t);return Object(m.jsx)(o.a,{children:Object(m.jsxs)(l.d,{children:[Object(m.jsx)(l.b,{path:"/login",children:Object(m.jsx)(h,{auth:a})}),Object(m.jsx)(l.b,{path:"/register",children:Object(m.jsx)(Ce,{api:e})}),Object(m.jsx)(ve,{auth:a,path:"/",children:Object(m.jsx)(xe,{auth:a})})]})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(385),a(386);i.a.render(Object(m.jsx)(Me,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[387,1,2]]]);
//# sourceMappingURL=main.648531f2.chunk.js.map